<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="kkkkh&#39;s blog">
    <meta property="og:type" content="website">
    <meta name="description" content="kkkkh&#39;s blog">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        《深入浅出Node.js》- 11产品化 - undefined
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>

    









<meta name="generator" content="Hexo 7.1.1"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Record and convert </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpeg" />
        </div>
        <div class="name">
            <i>kkkkh</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <!-- <li >
                <a href="/categories">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>nav.categories</span>
                </a>
            </li> -->
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/collect/">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>收藏</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Record and convert </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        《深入浅出Node.js》- 11产品化
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2024-03-08 17:13:22</span></span>
        <!-- 
        </span> -->
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#server" title="server">server</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#Nodejs" title="Nodejs">Nodejs</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <blockquote>
<p>node要实际作为一款产品运用，要多方面考虑：部署、性能、日志、监控、多机器、容灾备份等，实际中工作量非常多<br>产品化</p>
</blockquote>
<ul>
<li>1、工程化<ul>
<li>目录结构</li>
<li>构建工具 <ul>
<li>Makefile make linux（过时）</li>
<li>Grunt 媲美 java Maven（过时）</li>
<li>webpack、vite</li>
</ul>
</li>
<li>编码规范<ul>
<li>一种是文档式的约定， </li>
<li>一种是代码提交时的强制检查</li>
<li>JSLint和JSHint（过时）</li>
<li>eslint（目前）</li>
</ul>
</li>
<li>代码审查 <ul>
<li>gitlab</li>
<li>代码提交以后，审查再合并<ul>
<li>功能是否正确完成、 </li>
<li>编码风格是否符合规范、（工具）</li>
<li>单元测试是否有同步添加</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>2、部署<ul>
<li>测试环境 stage</li>
<li>预发布环境 pre-release</li>
<li>生产环境 product</li>
<li>部署操作<ul>
<li>nohup node app.js &amp;（以不挂断进程的方式执行）</li>
<li>bash 脚本(11.2appctl.sh)：实现应用的启动、 停止和重启等操作</li>
</ul>
</li>
</ul>
</li>
<li>3、性能<ul>
<li>原则<ul>
<li>做专一的事。</li>
<li>让擅长的工具做擅长的事情。</li>
<li>将模型简化。</li>
<li>将风险分离。</li>
</ul>
</li>
<li>方法<ul>
<li>动静分离<ul>
<li>图片、脚本、样式表和多媒体等静态文件放到专业的静态文件服务器上</li>
<li>用Nginx或者专业的CDN来处理</li>
<li>静态内容，直接进行Buffer传输可以很大程度上提升性能</li>
</ul>
</li>
<li>启用缓存 <ul>
<li>redis</li>
<li>具体场景：高并发读取场景、热点数据缓存、数据计算结果缓存、会话管理</li>
<li>启用redis带来了一些额外的复杂性：缓存一致性和缓存更新策略，需综合考虑</li>
</ul>
</li>
<li>多进程架构 <ul>
<li>cluster</li>
<li>pm、forever、pm2这样的模块用于进程管理</li>
</ul>
</li>
<li>读写分离<ul>
<li>读写分离，将数据库进行主从设计，这样读数据操作不再受到写入的影响</li>
<li>有一个主数据库（Master）和一个或多个从数据库（Slaves）。</li>
<li>所有的写操作都发送到主数据库，然后主数据库将写操作的日志传播给从数据库进行异步复制。</li>
<li>读操作可以从任意一个从数据库中进行，从数据库是只读的，并且与主数据库保持同步</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>4、日志<ul>
<li>访问日志 <ul>
<li>中间件框架connect提供日志功能</li>
</ul>
</li>
<li>异常日志 <ul>
<li>console.Console 实现自己的日志对象</li>
<li>每个开发者应当将API内部发生的异常作为第一个实参传递给回调函数</li>
<li>回调函数中产生的异常， 则可以不用过问， 交给全局的uncaughtException事件去捕获即可</li>
<li>异常尽量由最上层的捕获记录,底层只传递给上层</li>
<li>还要记着对日志进行格式化处理</li>
</ul>
</li>
<li>日志文件&#x2F;数据库（不推荐） <ul>
<li>日志记录可以在线写（日志消息写入本地文件或输出到控制台。这种方式可以提供实时的日志记录，）</li>
<li>日志分析则可以借助一些工具同步到数据库中，通过离线分析的方式反馈出来（海量日志，日志分析工具同步到数据库，进行分析）</li>
</ul>
</li>
<li>分割日志 <ul>
<li>按日期分割，保存，方便排查使用</li>
</ul>
</li>
</ul>
</li>
<li>5、监控报警<ul>
<li>设置上限，一旦大的波动，发出警报</li>
<li>监控<ul>
<li>5-1、日志监控 <ul>
<li>异常日志的监控，按照异常类型、数量反应出来，</li>
<li>子系统相关的反应子系统</li>
<li>QPS 检查业务在时间上的分布</li>
<li>pv uv 使用者们的习惯、 预知访问高峰等。</li>
</ul>
</li>
<li>5-2、响应时间<ul>
<li>可以在nginx方向代理上监控</li>
<li>或者访问日志监控</li>
<li>健康的应该是波动较小的、持续均衡的</li>
</ul>
</li>
<li>5-3、进程监控<ul>
<li>检查工作进程的数量， </li>
<li>如果低于预估值， 就应当发出报警声。</li>
</ul>
</li>
<li>5-4、磁盘监控 <ul>
<li>用量 一旦不够用各种问题</li>
<li>设置一个上限， 一旦磁盘用量超过警戒值</li>
<li>就整理日志、清理磁盘</li>
</ul>
</li>
<li>5-5、内存监控 <ul>
<li>内存泄漏</li>
<li>只升不降，肯定内存泄漏</li>
<li>解决方法：多进程架构服务群，规定每个进程服务数量，满了，就启动新的，旧的逐次关闭</li>
</ul>
</li>
<li>5-6、CUP占用监控 <ul>
<li>如果用户态CPU使用率较高， 说明服务器上的应用需要大量的CPU开销； </li>
<li>如果内核态CPU使用率较高， 说明服务器花费大量时间进行进程调度或者系统调用； </li>
<li>IOWait使用率则反应的是CPU等待磁盘I&#x2F;O操作。</li>
<li>用户态小于70%、内核态小于35%且整体小于70%时，属于健康</li>
</ul>
</li>
<li>5-7、CUP load监控（CPU负载均衡）  <ul>
<li>描述操作系统当前的繁忙程度， </li>
<li>CPU在单位时间内正在使用和等待使用CPU的平均任务数</li>
<li>三个指标：1分钟的平均负载、 5分钟的平均负载、 15分钟的平均负载</li>
<li>CPU load过高说明：进程数量过多，可能用子进程模块反复启动新的进程。</li>
</ul>
</li>
<li>5-8、I&#x2F;O负载 磁盘I&#x2F;O<ul>
<li>磁盘上的读写情况，也应监控</li>
</ul>
</li>
<li>5-9、网络监控 <ul>
<li>需要对流量进行监控并设置上限值</li>
<li>超过警戒值， 开发者就应当找出流量增长的原因</li>
<li>监控两个指标：流入流量和流出流量</li>
</ul>
</li>
<li>5-10、应用状态监控<ul>
<li>提供一种机制反馈自身的状态</li>
<li>外部持续调用反馈接口，进行检查</li>
<li>相关状态打印出来：数据库连接是否正常、缓存是否正常</li>
</ul>
</li>
<li>5-11、DNS监控<ul>
<li>实际服务产品，对域名都有依赖</li>
<li>dns故障并大面积影响并不少见，重视</li>
<li>免费的DNS监控服务， 如DNSPod等</li>
</ul>
</li>
</ul>
</li>
<li>报警实现<ul>
<li>nodemailer模块 -&gt; 邮件</li>
<li>短信、电话报警</li>
</ul>
</li>
</ul>
</li>
<li>6、稳定性<ul>
<li>多进程、 </li>
<li>多机器、 多机房</li>
<li>容灾备份</li>
<li>应用自身的部署考虑，如依赖的数据库、缓存等服务也要考虑。</li>
</ul>
</li>
<li>7、异构共存<ul>
<li>一部分是在全新的项目中应用， </li>
<li>一部分是改造已有系统通过Node来提升性能。 </li>
<li>几乎没有将已有系统推翻用Node来进行重建的。</li>
</ul>
</li>
</ul>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/kkkkh">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <!-- <span>/</span> -->
        
        
        <span><a target="_blank" rel="noopener" href="https://gen.zhtk.top">gen</a></span>
        
        
        <span>/</span>
        
        <span><a target="_blank" rel="noopener" href="https://med.zhtk.top">med</a></span>
        
        
        <span>/</span>
        
        <span><a href="">京ICP备2021005439号</a></span>
        
    </p>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        <!-- Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p> -->
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://giscus.app/client.js"
  data-repo="kkkkh/my-blog"
  data-repo-id="R_kgDOLb1f6w"
  data-category="Announcements"
  data-category-id="DIC_kwDOLb1f684CduwR"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="bottom"
  data-theme="light"
  data-lang="zh-CN"
  crossorigin="anonymous"
  async>
</script>




</html>
